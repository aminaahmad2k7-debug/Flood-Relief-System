<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Data - Flood Relief System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bundle.css') }}">
</head>

<body>

<header class="header">
    <div class="header__container container">
        <a href="{{ url_for('index') }}" class="header__logo">
            <span>ðŸŒŠ</span>
            <span>Flood Relief System</span>
        </a>

        <nav class="nav">
            <ul class="nav__list" id="navList">
                <li class="nav__item">
                    <a href="{{ url_for('upload_page') }}" class="nav__link nav__link--active">Upload Data</a>
                </li>
                <li class="nav__item">
                    <a href="{{ url_for('index') }}" class="nav__link">Dashboard</a>
                </li>
                <li class="nav__item">
                    <a href="{{ url_for('districts') }}" class="nav__link">Districts</a>
                </li>
            </ul>

            <button class="nav__toggle" id="navToggle" aria-label="Toggle navigation">
                <span class="nav__toggle-icon"></span>
            </button>
        </nav>
    </div>
</header>

<main class="main">
<div class="container">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert--{{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="page-header">
        <h1 class="page-title">Upload Flood Data</h1>
        <p class="page-subtitle">Import CSV data to update district information</p>
    </div>

    <!-- Upload Form -->
    <section class="section">
        <div class="card" style="max-width: 600px; margin: 0 auto;">
            <div class="card__header">
                <h2 class="card__title">Upload CSV File</h2>
            </div>
            <div class="card__body">
                <form method="POST" enctype="multipart/form-data">
                    <div style="margin-bottom: 1rem;">
                        <label for="file" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Select CSV File
                        </label>
                        <input type="file" 
                               id="file" 
                               name="file" 
                               accept=".csv"
                               required
                               style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    </div>

                    <button type="submit" class="btn btn--primary" style="width: 100%;">
                        Upload File
                    </button>
                </form>

                <div style="margin-top: 1.5rem; padding: 1rem; background: #f3f4f6; border-radius: 4px;">
                    <h4 style="margin-bottom: 0.5rem;">Required CSV Format:</h4>
                    <p style="font-size: 0.875rem; color: #666;">
                        Your CSV file should contain the following columns:<br>
                        <code>District, Affected_Population, Severity_Level, Displaced_Families</code>
                    </p>
                    <a href="{{ url_for('download_sample_csv') }}"
                       class="btn btn--sm btn--outline" 
                       style="margin-top: 0.5rem; display: inline-block;">
                        Download Sample CSV
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Summary -->
    <section class="section">
        <h2 style="margin-bottom: 1rem;">Current Summary</h2>
        <div class="grid grid--4">
            <div class="metric">
                <p class="metric__label">Population Affected</p>
                <h3 class="metric__value">{{ "{:,}".format(total_population) }}</h3>
            </div>
            <div class="metric">
                <p class="metric__label">Houses Damaged</p>
                <h3 class="metric__value">{{ "{:,}".format(total_houses) }}</h3>
            </div>
            <div class="metric">
                <p class="metric__label">Casualties</p>
                <h3 class="metric__value">{{ total_casualties }}</h3>
            </div>
            <div class="metric">
                <p class="metric__label">Relief Required</p>
                <h3 class="metric__value">PKR {{ "{:,}".format(total_relief) }}</h3>
            </div>
        </div>
    </section>

    <!-- District Table -->
    <section class="section">
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Top Districts</h2>
            </div>
            <div class="table-wrapper">
                <table class="table table--striped">
                    <thead>
                        <tr>
                            <th>District</th>
                            <th>Population</th>
                            <th>Houses</th>
                            <th>Relief required</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in top_districts %}
                        <tr>
                            <td><strong>{{ d.name }}</strong></td>
                            <td>{{ "{:,}".format(d.population) }}</td>
                            <td>{{ "{:,}".format(d.houses) }}</td>
                            <td>PKR {{ "{:,}".format(d.relief) }}</td>
                            <td>
                                <a href="{{ url_for('district_detail', district_id=d.id) }}"
                                   class="btn btn--sm btn--outline">
                                    View
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

</div>
</main>

<footer class="footer">
    <div class="footer__container container">
        <p>Â© 2025 Flood Relief System</p>
    </div>
</footer>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>